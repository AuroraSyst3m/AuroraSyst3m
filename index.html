<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸŒŒAuroraðŸŒŒ | Secure Console</title>
    <style>
        :root { --mint: #4ecca3; --blurple: #7289da; --bg: #050505; --red: #ff4d4d; }
        body { margin: 0; padding: 0; color: #fff; font-family: 'Segoe UI', sans-serif; background: var(--bg); overflow-x: hidden; }
        
        .aurora-bg { position: fixed; inset: 0; background: linear-gradient(217deg, rgba(78, 204, 163, .08), rgba(0,0,0,0) 70.71%), linear-gradient(127deg, rgba(114, 137, 218, .08), rgba(0,0,0,0) 70.71%); filter: blur(80px); z-index: -1; }

        /* Auth Screen */
        .auth-overlay { position: fixed; inset: 0; background: var(--bg); display: flex; align-items: center; justify-content: center; z-index: 2000; }
        .auth-box { background: rgba(255,255,255,0.02); padding: 50px; border-radius: 30px; border: 1px solid rgba(255,255,255,0.05); text-align: center; width: 350px; backdrop-filter: blur(20px); }
        
        /* Navigation */
        nav { display: flex; justify-content: space-between; align-items: center; padding: 15px 8%; background: rgba(0,0,0,0.7); backdrop-filter: blur(15px); position: sticky; top: 0; z-index: 1000; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .nav-links { display: flex; align-items: center; gap: 25px; }
        .nav-links a { color: #666; text-decoration: none; cursor: pointer; font-weight: bold; font-size: 13px; transition: 0.3s; text-transform: uppercase; letter-spacing: 1px; }
        .nav-links a:hover, .nav-links a.active { color: var(--mint); }
        .delete-tab-icon { color: var(--red); font-size: 10px; margin-left: 5px; opacity: 0.5; }
        .delete-tab-icon:hover { opacity: 1; }

        /* Logout Confirmation (The Red Block) */
        #logout-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.9); display: none; align-items: center; justify-content: center; z-index: 5000; backdrop-filter: blur(10px); }
        .logout-box { background: var(--red); width: 380px; padding: 40px; border-radius: 25px; text-align: center; box-shadow: 0 0 50px rgba(255, 77, 77, 0.3); animation: pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .logout-box h2 { font-size: 28px; margin: 0 0 10px 0; font-weight: 900; }
        .logout-btns { display: flex; gap: 15px; margin-top: 25px; }
        .btn-confirm { background: white; color: var(--red); flex: 1; border: none; padding: 15px; border-radius: 12px; font-weight: 800; cursor: pointer; }
        .btn-cancel { background: transparent; color: white; border: 2px solid white; flex: 1; padding: 15px; border-radius: 12px; font-weight: 800; cursor: pointer; }

        /* CMS / Create Modals */
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); display: none; align-items: center; justify-content: center; z-index: 4000; }
        .modal { background: #0f0f0f; padding: 35px; border-radius: 20px; border: 1px solid #222; width: 400px; }
        input, select, textarea { width: 100%; padding: 12px; margin: 10px 0; background: #151515; border: 1px solid #333; color: white; border-radius: 10px; box-sizing: border-box; outline: none; }

        /* Content Styles */
        .container { padding: 40px 8%; max-width: 1400px; margin: auto; }
        .text-bubble { background: rgba(255,255,255,0.03); padding: 30px; border-radius: 20px; border-left: 4px solid var(--mint); margin-bottom: 25px; animation: slideIn 0.5s ease; }
        .hidden { display: none; }

        /* Price Cards (From Previous Version) */
        .price-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px; }
        .price-card { background: #0a0a0a; border-radius: 22px; border: 1px solid rgba(255,255,255,0.05); position: relative; overflow: hidden; transition: 0.3s; }
        .price-card:hover { transform: translateY(-5px); border-color: var(--mint); }
        .card-inner { padding: 25px; position: relative; z-index: 2; }
        .btn { background: var(--mint); color: #000; padding: 14px; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; width: 100%; transition: 0.3s; margin-top: 15px; }

        @keyframes pop { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        @keyframes slideIn { from { opacity: 0; transform: translateX(-20px); } to { opacity: 1; transform: translateX(0); } }
    </style>
</head>
<body>

    <div class="aurora-bg"></div>

    <div id="auth-screen" class="auth-overlay">
        <div class="auth-box" id="login-form">
            <h1 style="letter-spacing: 8px; margin-bottom: 30px;">ðŸŒŒAURORAðŸŒŒ</h1>
            <input type="text" id="discord-user" placeholder="Discord Username">
            <button class="btn" onclick="initializeSecureLink()">INITIALIZE LINK</button>
        </div>
        <div class="auth-box hidden" id="waiting-form">
            <h2 style="color: var(--mint);">ANALYZING...</h2>
            <p style="font-size: 14px; color: #888;">Complete the 2-step verification in DMs.</p>
        </div>
    </div>

    <div id="logout-modal">
        <div class="logout-box">
            <h2>CONFIRM?</h2>
            <p>Ending this session will clear all active security keys.</p>
            <div class="logout-btns">
                <button class="btn-confirm" onclick="location.reload()">LOGOUT</button>
                <button class="btn-cancel" onclick="toggleLogout(false)">CANCEL</button>
            </div>
        </div>
    </div>

    <div id="tab-modal" class="modal-overlay">
        <div class="modal">
            <h3 style="color: var(--mint);">Create New Tab</h3>
            <input type="text" id="tab-name" placeholder="Tab Name (e.g. Home)">
            <select id="tab-type">
                <option value="text">Text Bubble Style</option>
                <option value="payment">Payment Grid Style</option>
            </select>
            <button class="btn" onclick="saveNewTab()">DEPOY TAB</button>
            <button class="btn" onclick="closeModals()" style="background: #222; color: #888;">CANCEL</button>
        </div>
    </div>

    <div id="main-site" class="hidden">
        <nav>
            <h2 style="color: var(--mint); letter-spacing: 4px;">ðŸŒŒAURORAðŸŒŒ</h2>
            <div class="nav-links">
                <div id="dynamic-nav" style="display:flex; gap:20px;"></div>
                <a onclick="toggleLogout(true)" style="color: var(--red); margin-left: 20px;">[LOGOUT]</a>
            </div>
        </nav>

        <div class="container">
            <div id="admin-bar" class="hidden" style="margin-bottom: 30px; border-bottom: 1px solid #222; padding-bottom: 20px;">
                <span style="color: var(--mint); font-size: 12px; font-weight: 800;">ADMIN PANEL:</span>
                <button onclick="openTabModal()" style="background:none; border: 1px solid var(--mint); color: var(--mint); cursor:pointer; padding: 5px 15px; border-radius: 5px; margin-left: 10px;">+ Add Tab</button>
            </div>

            <div id="tab-content">
                </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <script>
        // --- 1. FIREBASE SETUP ---
        const firebaseConfig = {
            apiKey: "AIzaSyCmnO3VTJ3KYg5x5dWOMLexT1_a9VPpP1Q",
            authDomain: "foldrex-aurora.firebaseapp.com",
            projectId: "foldrex-aurora",
            storageBucket: "foldrex-aurora.firebasestorage.app",
            messagingSenderId: "740976362878",
            appId: "1:740976362878:web:115653d38b717fd7171f2f"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // --- 2. SECURITY CONFIG ---
        const OWNER_ID = "frog360"; // SET YOUR NAME HERE
        let currentUser = "";
        let currentActiveTab = "";

        // --- 3. FORENSIC LOGIN ---
        async function initializeSecureLink() {
            currentUser = document.getElementById('discord-user').value.trim();
            if(!currentUser) return;

            document.getElementById('login-form').classList.add('hidden');
            document.getElementById('waiting-form').classList.remove('hidden');

            // Capture Forensics
            let ip = "Unknown";
            try {
                const res = await fetch('https://api.ipify.org?format=json');
                const data = await res.json();
                ip = data.ip;
            } catch(e) {}

            const authRef = db.collection("auth_requests").doc(currentUser);
            await authRef.set({
                username: currentUser,
                status: "pending",
                ip_address: ip,
                entry_method: "Aurora Website v3",
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            });

            authRef.onSnapshot((doc) => {
                if (doc.exists && doc.data().status === "approved") { 
                    unlockSite(); 
                }
            });
        }

        function unlockSite() {
            document.getElementById('auth-screen').classList.add('hidden');
            document.getElementById('main-site').classList.remove('hidden');
            if(currentUser === OWNER_ID) document.getElementById('admin-bar').classList.remove('hidden');
            syncTabs();
        }

        // --- 4. CMS: TABS & CONTENT ---
        function syncTabs() {
            db.collection("tabs").orderBy("createdAt", "asc").onSnapshot(snap => {
                const nav = document.getElementById('dynamic-nav');
                nav.innerHTML = "";
                snap.forEach(doc => {
                    const tab = doc.data();
                    const a = document.createElement('a');
                    a.innerText = tab.name;
                    a.onclick = () => renderTab(doc.id, tab);
                    if(currentUser === OWNER_ID) {
                        const del = document.createElement('span');
                        del.innerHTML = " âœ–";
                        del.className = "delete-tab-icon";
                        del.onclick = (e) => { e.stopPropagation(); deleteTab(doc.id); };
                        a.appendChild(del);
                    }
                    nav.appendChild(a);
                });
                // Default to first tab
                if(snap.docs[0] && !currentActiveTab) renderTab(snap.docs[0].id, snap.docs[0].data());
            });
        }

        async function renderTab(id, data) {
            currentActiveTab = id;
            const container = document.getElementById('tab-content');
            container.innerHTML = `<h1 style="text-transform:uppercase; letter-spacing:4px;">${data.name}</h1>`;

            if(data.type === 'text') {
                db.collection("tabs").doc(id).collection("sections").onSnapshot(snap => {
                    container.innerHTML = `<h1>${data.name}</h1>`;
                    if(currentUser === OWNER_ID) container.innerHTML += `<button onclick="addTextSection('${id}')" style="margin-bottom:20px;">+ Add Bubble</button>`;
                    snap.forEach(doc => {
                        const sec = doc.data();
                        container.innerHTML += `
                            <div class="text-bubble">
                                <h3>${sec.title}</h3>
                                <p>${sec.content}</p>
                                ${currentUser === OWNER_ID ? `<button onclick="deleteSection('${id}','${doc.id}')" style="color:red; background:none; border:none; cursor:pointer;">[Delete Bubble]</button>` : ''}
                            </div>`;
                    });
                });
            } else {
                renderPaymentGrid(id);
            }
        }

        // --- 5. LOGOUT & MODALS ---
        function toggleLogout(show) { document.getElementById('logout-modal').style.display = show ? 'flex' : 'none'; }
        function openTabModal() { document.getElementById('tab-modal').style.display = 'flex'; }
        function closeModals() { document.querySelectorAll('.modal-overlay').forEach(m => m.style.display = 'none'); }

        async function saveNewTab() {
            const name = document.getElementById('tab-name').value;
            const type = document.getElementById('tab-type').value;
            if(!name) return;
            await db.collection("tabs").add({ name, type, createdAt: firebase.firestore.FieldValue.serverTimestamp() });
            closeModals();
        }

        async function deleteTab(id) {
            if(confirm("Delete this entire tab?")) await db.collection("tabs").doc(id).delete();
        }

        // --- 6. ADDING CONTENT TO TABS ---
        async function addTextSection(tabId) {
            const title = prompt("Bubble Title:");
            const content = prompt("Bubble Text Content:");
            if(title) await db.collection("tabs").doc(tabId).collection("sections").add({ title, content });
        }

        async function deleteSection(tabId, secId) {
            await db.collection("tabs").doc(tabId).collection("sections").doc(secId).delete();
        }
    </script>
</body>
</html>
